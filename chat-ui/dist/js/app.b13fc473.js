(function(){"use strict";var e={4524:function(e,t,n){var s=n(9242),a=n(3396),o=(0,a.aZ)({__name:"App",setup(e){const t=()=>{let e=sessionStorage.getItem("name");null==e&&""==e||(sessionStorage.removeItem("name"),sessionStorage.clear())};return window.addEventListener("beforeunload",t),(e,t)=>{const n=(0,a.up)("router-view");return(0,a.wg)(),(0,a.j4)(n,null,{default:(0,a.w5)((({Component:e})=>[((0,a.wg)(),(0,a.j4)(a.Ob,null,[((0,a.wg)(),(0,a.j4)((0,a.LL)(e)))],1024))])),_:1})}}});const r=o;var l=r,u=n(2483),i=(n(7658),n(4870)),c=n(7178),m=n(4161);const p={class:"name"},d=(0,a._)("h1",null,"EZ-Chat",-1);var g=(0,a.aZ)({__name:"NameView",setup(e){const t=(0,i.iH)(),n=(0,i.qj)({nickname:""}),o=(0,i.qj)({nickname:[{required:!0,message:"请输入一个昵称",trigger:"blur"}]}),r=e=>{e&&e.validate((e=>{if(!e)return(0,c.z8)({message:"请输入一个昵称",grouping:!0,type:"error"}),!1;m.Z.get("http://localhost:8888/list/"+n.nickname).then((e=>{const t=e.data;t.isExist?(0,c.z8)({message:"该用户名已存在，请更换",grouping:!0,type:"error"}):(sessionStorage.setItem("name",n.nickname),T.push("/chat"))}))}))};return(e,l)=>{const u=(0,a.up)("el-form-item"),i=(0,a.up)("el-input"),c=(0,a.up)("el-button"),m=(0,a.up)("el-form");return(0,a.wg)(),(0,a.iD)("div",p,[(0,a.Wm)(m,{class:"name-form",ref_key:"nameFormRef",ref:t,model:n,rules:o,onSubmit:l[3]||(l[3]=(0,s.iM)((()=>{}),["prevent"]))},{default:(0,a.w5)((()=>[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[d])),_:1}),(0,a.Wm)(u,{class:"name-input",prop:"nickname"},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{class:"nickname",modelValue:n.nickname,"onUpdate:modelValue":l[0]||(l[0]=e=>n.nickname=e),onKeydown:l[1]||(l[1]=(0,s.D2)((e=>r(t.value)),["enter"])),placeholder:"输入一个昵称"},null,8,["modelValue"]),(0,a.Wm)(c,{class:"submit",type:"primary",onClick:l[2]||(l[2]=e=>r(t.value))},{default:(0,a.w5)((()=>[(0,a.Uk)("进入")])),_:1})])),_:1})])),_:1},8,["model","rules"])])}}});const v=g;var f=v,h=n(7139);const w={class:"chat"},k={class:"list-pane"},_={class:"user-pane"},y={class:"user-count"},b={class:"user-list"},S={class:"username"},O={class:"chat-pane"},W={class:"chat-header"},j={class:"chat-message",ref:"chatHistory"},x={class:"img"},D={class:"message"},H={class:"username"},U={class:"time"},z={key:0,class:"text user-text"},C={key:1,class:"text"},V={class:"chat-textarea"};var Z=(0,a.aZ)({__name:"ChatView",setup(e){let t,o=(0,i.iH)();(0,a.dl)((()=>{if(o.value=sessionStorage.getItem("name"),null==o.value)return void T.push("/");if("undefined"==typeof WebSocket)return alert("您的浏览器不支持 WebSocket"),void T.push("/");let e="localhost",n="8888",s="ws://"+e+":"+n+"/socket/"+o.value;t=new WebSocket(s),t.onopen=()=>{console.log("已连接至服务器")},t.onmessage=e=>{let t=JSON.parse(e.data);if(t.userlist)c.value=t.userlist,u.value=t.userlist.length;else{p.value.push(t);let e=document.getElementsByClassName("chat-message")[0];e.scrollHeight>=e.clientHeight&&setTimeout((function(){e.scrollTop=e.scrollHeight}),0)}},t.onclose=()=>{console.log("WebSocket 服务已关闭")},t.onerror=()=>{console.log("WebSocket 服务发生错误")}}));const r=e=>{const t=e.getFullYear(),n=e.getMonth()+1,s=e.getDate(),a=e.getHours(),o=e.getMinutes(),r=e.getSeconds();return[t,n,s].map(l).join("-")+" "+[a,o,r].map(l).join(":")},l=e=>{const t=e.toString();return t[1]?t:"0"+t};let u=(0,i.iH)(0),c=(0,i.iH)([]),m=(0,i.iH)(""),p=(0,i.iH)([]),d={name:"",time:"",msg:""};const g=e=>{e.preventDefault(),null!=m.value&&""!==m.value&&null!=o.value&&(d.name=o.value,d.time=r(new Date),d.msg=m.value,t.send(JSON.stringify(d)),d.msg="",m.value="")};return(e,t)=>{const r=(0,a.up)("el-image"),l=(0,a.up)("el-input"),d=(0,a.up)("el-button");return(0,a.wg)(),(0,a.iD)("div",w,[(0,a._)("div",k,[(0,a._)("div",_,[(0,a._)("div",y,[(0,a._)("h2",null,"当前在线人数："+(0,h.zw)((0,i.SU)(u)),1)]),(0,a._)("div",b,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)((0,i.SU)(c),(e=>((0,a.wg)(),(0,a.iD)("div",{class:"user",key:e},[(0,a.Wm)(r,{class:"user-img",src:n(4353)},null,8,["src"]),(0,a._)("p",S,(0,h.zw)(e),1)])))),128))])])]),(0,a._)("div",O,[(0,a._)("div",W,[(0,a._)("h2",null,"EZ-Chat - "+(0,h.zw)((0,i.SU)(o)),1)]),(0,a._)("div",j,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)((0,i.SU)(p),(e=>((0,a.wg)(),(0,a.iD)("div",{class:"user-message",key:e},[(0,a._)("div",x,[(0,a.Wm)(r,{class:"user-img",src:n(4353)},null,8,["src"])]),(0,a._)("div",D,[(0,a._)("div",H,[(0,a.Uk)((0,h.zw)(e.name)+" ",1),(0,a._)("span",U,(0,h.zw)(e.time),1)]),(0,i.SU)(o)===e.name?((0,a.wg)(),(0,a.iD)("div",z,(0,h.zw)(e.msg),1)):(0,a.kq)("",!0),(0,i.SU)(o)!==e.name?((0,a.wg)(),(0,a.iD)("div",C,(0,h.zw)(e.msg),1)):(0,a.kq)("",!0)])])))),128))],512),(0,a._)("div",V,[(0,a.Wm)(l,{modelValue:(0,i.SU)(m),"onUpdate:modelValue":t[0]||(t[0]=e=>(0,i.dq)(m)?m.value=e:m=e),class:"user-textarea",type:"textarea",resize:"none",onKeydown:(0,s.D2)(g,["enter"])},null,8,["modelValue","onKeydown"]),(0,a.Wm)(d,{type:"primary",class:"send-button",onClick:g},{default:(0,a.w5)((()=>[(0,a.Uk)("发送")])),_:1})])])])}}});const q=Z;var E=q;const K=[{path:"/",name:"name",component:f,meta:{keepAlive:!0}},{path:"/chat",name:"chat",component:E,meta:{keepAlive:!0}}],M=(0,u.p7)({history:(0,u.PO)("/"),routes:K});var T=M,I=n(65),N=(0,I.MT)({state:{},getters:{},mutations:{},actions:{},modules:{}}),A=n(2065),F=(n(2834),n(812));const L=(0,s.ri)(l);L.use(A.Z,{locale:F.Z}),L.use(N).use(T).mount("#app")},4353:function(e,t,n){e.exports=n.p+"img/user.f79e360b.png"}},t={};function n(s){var a=t[s];if(void 0!==a)return a.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,n),o.exports}n.m=e,function(){var e=[];n.O=function(t,s,a,o){if(!s){var r=1/0;for(c=0;c<e.length;c++){s=e[c][0],a=e[c][1],o=e[c][2];for(var l=!0,u=0;u<s.length;u++)(!1&o||r>=o)&&Object.keys(n.O).every((function(e){return n.O[e](s[u])}))?s.splice(u--,1):(l=!1,o<r&&(r=o));if(l){e.splice(c--,1);var i=a();void 0!==i&&(t=i)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[s,a,o]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.p="/"}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,s){var a,o,r=s[0],l=s[1],u=s[2],i=0;if(r.some((function(t){return 0!==e[t]}))){for(a in l)n.o(l,a)&&(n.m[a]=l[a]);if(u)var c=u(n)}for(t&&t(s);i<r.length;i++)o=r[i],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(c)},s=self["webpackChunkchat_ui"]=self["webpackChunkchat_ui"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=n.O(void 0,[998],(function(){return n(4524)}));s=n.O(s)})();
//# sourceMappingURL=app.b13fc473.js.map